<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pizza: perch√© servono spicchi uguali (MCM)</title>
<style>
  :root{
    --bg:#f6f9ff; --ink:#0f172a; --card:#ffffff; --grid:#dbe3ef;
    --a:#2563eb; --b:#16a34a; --good:#0a7d32; --bad:#b91c1c; --line:#93a7bd55;
  }
  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:920px; margin:0 auto; padding:16px}
  .top{position:sticky; top:0; z-index:5; background:var(--bg)}
  .prompt{
    background:var(--card); border:1px solid var(--grid); border-radius:16px;
    padding:12px 16px; font-size:1.22rem; font-weight:800; text-align:center
  }
  .guide{margin-top:8px; text-align:center; font-size:1.05rem; font-weight:600; color:#0b3a6f}
  .stepper{display:flex; gap:8px; justify-content:center; margin:10px 0 6px}
  .dot{width:10px; height:10px; border-radius:50%; background:#cbd5e1; border:1px solid var(--grid)}
  .dot.on{background:#0ea5e9}
  .card{background:var(--card); border:1px solid var(--grid); border-radius:18px; padding:16px; margin:12px 0}
  .center{display:flex; align-items:center; justify-content:center}
  .grid{display:grid; gap:14px}
  .g2{grid-template-columns:1fr 1fr}
  @media (max-width:800px){ .g2{grid-template-columns:1fr} }
  .big-btn{
    display:inline-flex; align-items:center; justify-content:center;
    padding:16px 18px; border:2px solid var(--grid); border-radius:16px; font-size:1.4rem;
    background:#fff; cursor:pointer; width:100%
  }
  .big-btn:active{transform:scale(0.98)}
  .big-btn.good{border-color:var(--good)}
  .big-btn.bad{border-color:var(--bad)}
  .row-btns{display:grid; grid-template-columns:repeat(5,1fr); gap:10px}
  .pie{
    width:200px; height:200px; border-radius:50%;
    border:10px solid #eef2f7; box-shadow:0 2px 6px rgba(0,0,0,.05); position:relative
  }
  .label{font-size:1.15rem; font-weight:800; text-align:center; margin-top:10px}
  .legend{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:6px}
  .chip{display:inline-flex; gap:6px; align-items:center; padding:6px 10px; border:1px solid var(--grid); border-radius:999px; background:#fff}
  .dotc{width:12px; height:12px; border-radius:50%}
  .a{background:var(--a)} .b{background:var(--b)}
  .eq{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:1.35rem; text-align:center}
  .msg{font-size:1.15rem; font-weight:800; text-align:center; margin-top:10px}
  .ok{color:var(--good)} .err{color:var(--bad)}
  .hidden{display:none}
  .actions{display:flex; gap:10px; justify-content:center; margin-top:10px}
  .pill{padding:8px 14px; border:1px solid var(--grid); border-radius:999px; background:#fff; font-weight:700; cursor:pointer}
  .bar{height:22px; border-radius:999px; border:1px solid var(--grid); overflow:hidden; background:#eef3fb}
  .seg{height:100%}
  .why{background:#fffaf2; border:1px solid #f4e4c3; border-radius:16px; padding:12px; font-weight:700}
  .why p{margin:6px 0; font-size:1rem}
  .mini{font-size:.95rem; color:#334155}
</style>
</head>
<body>
<div class="wrap">
  <!-- CONSEGNA PRATICA + GUIDA -->
  <div class="top" aria-live="polite">
    <div class="prompt" id="prompt">
      Problema: dobbiamo mettere sullo stesso piatto <b>1/2 pizza</b> (A) e <b>1/3 pizza</b> (B). <u>In quanti spicchi uguali</u> tagliamo la pizza per poterle sommare?
    </div>
    <div class="guide" id="guide">Guida: tocca il numero degli spicchi. Devono andare bene per <b>A e B</b>.</div>
    <div class="stepper"><span class="dot on" id="d1"></span><span class="dot" id="d2"></span><span class="dot" id="d3"></span></div>
  </div>

  <!-- STEP 1 -->
  <section class="card" id="s1" aria-label="Step 1">
    <div class="grid g2">
      <div class="center">
        <div>
          <div class="center"><div class="pie" id="pieA" aria-label="Pizza A 1/2"></div></div>
          <div class="label">A = 1/2 pizza</div>
        </div>
      </div>
      <div class="center">
        <div>
          <div class="center"><div class="pie" id="pieB" aria-label="Pizza B 1/3"></div></div>
          <div class="label">B = 1/3 pizza</div>
        </div>
      </div>
    </div>

    <div class="legend">
      <span class="chip"><span class="dotc a"></span> A</span>
      <span class="chip"><span class="dotc b"></span> B</span>
      <span class="chip">üçï spicchi uguali</span>
    </div>

    <div style="height:12px"></div>
    <div class="row-btns" role="group" aria-label="Scegli il numero di spicchi">
      <button class="big-btn" data-n="2">2</button>
      <button class="big-btn" data-n="3">3</button>
      <button class="big-btn" data-n="4">4</button>
      <button class="big-btn" data-n="5">5</button>
      <button class="big-btn" data-n="6">6</button>
    </div>
    <div class="msg" id="msg1"></div>

    <!-- perch√© servono spicchi uguali (pratico) -->
    <div class="why" style="margin-top:12px">
      <p>Perch√© spicchi uguali? <span class="mini">Cos√¨ i pezzi hanno la <b>stessa grandezza</b> ‚Üí li conti e li sommi senza ‚Äúbarare‚Äù.</span></p>
      <p class="mini">√à come usare lo <b>stesso righello</b>: se A misura in ‚Äúmezzi‚Äù e B in ‚Äúterzi‚Äù, non combacia. Con 6 spicchi, <b>parlano la stessa lingua</b>.</p>
    </div>
  </section>

  <!-- STEP 2 -->
  <section class="card hidden" id="s2" aria-label="Step 2">
    <div class="eq" id="eq2">1/2 ‚ü∂ 3/6‚ÄÉ‚ÄÉ1/3 ‚ü∂ 2/6</div>
    <div style="height:10px"></div>
    <div class="grid g2">
      <div>
        <div class="label">A in 6 spicchi</div>
        <div class="bar"><div class="seg" id="barA" style="width:50%; background:var(--a)"></div></div>
      </div>
      <div>
        <div class="label">B in 6 spicchi</div>
        <div class="bar"><div class="seg" id="barB" style="width:33.333%; background:var(--b)"></div></div>
      </div>
    </div>
    <div class="actions">
      <button class="pill" id="goJoin">Metti insieme</button>
      <button class="pill" id="back1">Indietro</button>
    </div>
  </section>

  <!-- STEP 3 -->
  <section class="card hidden" id="s3" aria-label="Step 3">
    <div class="eq" id="eq3">3/6 + 2/6 = <b>5/6</b> di pizza</div>
    <div style="height:10px"></div>
    <div class="bar">
      <div class="seg" id="barSum" style="width:83.333%; background:linear-gradient(90deg, var(--a) 0 60%, var(--b) 60% 100%)"></div>
    </div>
    <div class="msg ok">Risultato: <b>5 spicchi su 6</b> nello stesso piatto.</div>
    <div class="actions">
      <button class="pill" id="retry">Ricomincia</button>
    </div>
  </section>
</div>

<script>
/* ‚Äî Utility visuali ‚Äî */
function pieFill(parts, fillParts, color){
  const step = 360/parts, end = step*fillParts;
  return `conic-gradient(${color} 0 ${end}deg, #e5ecf6 ${end}deg 360deg)`;
}
function pieGrid(parts){
  // lineetta ogni fetta (1¬∞ di spessore circa)
  const step = 360/parts, thin = Math.max(0.8, 360/(parts*180)); // ~1¬∞
  return `repeating-conic-gradient(from 0deg, transparent 0 ${step-thin}deg, var(--line) ${step-thin}deg ${step}deg)`;
}
function drawPizza(el, parts, fillParts, color){
  el.style.background = `${pieFill(parts, fillParts, color)}, ${pieGrid(parts)}`;
}

const css = getComputedStyle(document.documentElement);
const pieA = document.getElementById('pieA');
const pieB = document.getElementById('pieB');
// Iniziale: si vedono le frazioni originali SENZA griglia comune
pieA.style.background = pieFill(2,1, css.getPropertyValue('--a'));
pieB.style.background = pieFill(3,1, css.getPropertyValue('--b'));

/* ‚Äî Stato e step ‚Äî */
const promptEl = document.getElementById('prompt');
const guideEl  = document.getElementById('guide');
const d1 = document.getElementById('d1'), d2 = document.getElementById('d2'), d3 = document.getElementById('d3');
const s1 = document.getElementById('s1'), s2 = document.getElementById('s2'), s3 = document.getElementById('s3');
const msg1 = document.getElementById('msg1');
const buttons = Array.from(document.querySelectorAll('.row-btns .big-btn'));
const eq2 = document.getElementById('eq2'), eq3 = document.getElementById('eq3');
const barA = document.getElementById('barA'), barB = document.getElementById('barB'), barSum = document.getElementById('barSum');

function setStep(n){
  [d1,d2,d3].forEach((dot,i)=>dot.classList.toggle('on', i < n));
  s1.classList.toggle('hidden', n!==1);
  s2.classList.toggle('hidden', n!==2);
  s3.classList.toggle('hidden', n!==3);

  if(n===1){
    promptEl.innerHTML = 'Problema: dobbiamo mettere sullo stesso piatto <b>1/2 pizza</b> (A) e <b>1/3 pizza</b> (B). <u>In quanti spicchi uguali</u> tagliamo la pizza per poterle sommare?';
    guideEl.textContent  = 'Guida: tocca il numero degli spicchi. Devono andare bene per entrambe.';
    // mostra frazioni originali senza griglia comune
    pieA.style.background = pieFill(2,1, css.getPropertyValue('--a'));
    pieB.style.background = pieFill(3,1, css.getPropertyValue('--b'));
  }
  if(n===2){
    promptEl.textContent = 'Ora entrambe le pizze hanno 6 spicchi (uguali).';
    guideEl.textContent  = 'Guida: tocca ‚ÄúMetti insieme‚Äù.';
  }
  if(n===3){
    promptEl.textContent = 'Abbiamo messo insieme le pizze nello stesso piatto.';
    guideEl.textContent  = 'Guida: guarda il risultato. Tocca ‚ÄúRicomincia‚Äù per rifare.';
  }
}

buttons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const n = parseInt(btn.dataset.n,10);
    const ok = (n%2===0)&&(n%3===0); // multiplo di 2 e di 3 ‚Üí 6
    buttons.forEach(b=>b.classList.remove('good','bad'));
    if(ok){
      btn.classList.add('good');
      msg1.className = 'msg ok';
      msg1.textContent = '‚úÖ Giusto: con 6 spicchi i pezzi sono uguali per A e per B.';
      // Mostra SUBITO i 6 spicchi disegnati su entrambe le pizze e i riempimenti 3/6 e 2/6
      drawPizza(pieA, 6, 3, css.getPropertyValue('--a'));
      drawPizza(pieB, 6, 2, css.getPropertyValue('--b'));
      // Prepara step 2 (barre in sesti)
      eq2.textContent = '1/2 ‚ü∂ 3/6‚ÄÉ‚ÄÉ1/3 ‚ü∂ 2/6';
      barA.style.width = (3/6*100)+'%';
      barB.style.width = (2/6*100)+'%';
      setTimeout(()=>setStep(2), 800);
    }else{
      btn.classList.add('bad');
      msg1.className = 'msg err';
      // Visualizza per un attimo la griglia scelta (per far "sentire" che non combacia)
      // A: n spicchi con met√† piena ‚Üí fillParts = n/2; B: n spicchi con un terzo pieno ‚Üí fillParts = n/3 (se intero)
      // se non √® intero, disegniamo comunque la griglia per mostrare che "non torna"
      drawPizza(pieA, n, Math.round(n/2), css.getPropertyValue('--a'));
      drawPizza(pieB, n, Math.round(n/3), css.getPropertyValue('--b'));
      if(n%2!==0 && n%3!==0) msg1.textContent = '‚ùå No: non va bene n√© per 1/2 n√© per 1/3.';
      else if(n%2!==0)       msg1.textContent = '‚ùå No: non va bene per 1/2.';
      else                   msg1.textContent = '‚ùå No: non va bene per 1/3.';
      // dopo 900ms torna alle frazioni originali (senza griglia comune)
      setTimeout(()=>{
        if(s1.classList.contains('hidden')) return;
        pieA.style.background = pieFill(2,1, css.getPropertyValue('--a'));
        pieB.style.background = pieFill(3,1, css.getPropertyValue('--b'));
      }, 900);
    }
  });
});

document.getElementById('goJoin').addEventListener('click', ()=>{
  eq3.innerHTML = '3/6 + 2/6 = <b>5/6</b> di pizza';
  barSum.style.width = (5/6*100)+'%';
  setStep(3);
});
document.getElementById('back1').addEventListener('click', ()=>setStep(1));
document.getElementById('retry').addEventListener('click', ()=>{
  buttons.forEach(b=>b.classList.remove('good','bad'));
  msg1.textContent = '';
  setStep(1);
});

setStep(1);
</script>
</body>
</html>
