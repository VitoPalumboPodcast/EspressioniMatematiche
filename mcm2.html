<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Problema: quanta pizza ho mangiato in totale? (somma frazioni con MCM)</title>
<style>
  :root{
    /* UI */
    --bg:#ffffff; --ink:#0f172a; --muted:#475569; --grid:#d8e0ea;
    /* Pizza */
    --crust:#c58a3b; --crust-dark:#a8732f;
    --sauce:#d1493a; --cheese:#f6d98e; --cheese-dot:#f9e7b9; --cheese-free:#ffffff;
    --basil:#2f9e44; --pepperoni:#b91c1c; --pepperoni-dark:#7f1212;
    --resto-hatch:#cbd5e1; /* tratteggio grigio per “resto” nella pizza MCM */
    /* Tag */
    --tag:#0f172a10;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:var(--bg); color:var(--ink); font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans");}
  /* A4 ~794x1123px @96dpi */
  .page{width:794px; min-height:1123px; margin:0 auto; padding:24px 28px; display:flex; flex-direction:column; gap:16px}
  h1{margin:0; font-size:32px; line-height:1.2; font-weight:800; text-align:center}
  h2{margin:6px 0 8px; font-size:22px; font-weight:800}
  p{margin:6px 0; font-size:18px; color:var(--muted)}
  .card{border:1px solid var(--grid); border-radius:14px; padding:16px}
  .controls{display:grid; grid-template-columns:repeat(4,1fr); gap:12px; align-items:end}
  label{font-weight:700; font-size:18px}
  input[type="number"]{width:100%; font-size:24px; padding:12px 10px; border:1px solid var(--grid); border-radius:10px; text-align:center}
  .fracBig{font-size:26px; font-weight:800; text-align:center}
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .center{display:flex; justify-content:center; align-items:center}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  .eq{font-size:26px; font-weight:800; text-align:center; padding:8px 10px; border:1px solid var(--grid); border-radius:10px; background:#f6f7fb}
  .msg{font-weight:800; text-align:center; margin-top:6px; font-size:18px}
  .ok{color:#0a7d32} .warn{color:#b45309}
  .pizzaBox{display:flex; flex-direction:column; align-items:center; gap:6px}
  svg{width:320px; height:320px; max-width:100%}
  .legend{display:flex; justify-content:center; gap:16px; flex-wrap:wrap; margin-top:6px; font-size:18px; color:var(--muted)}
  .chip{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--grid); padding:6px 10px; border-radius:999px; background:#fff}
  .bullet{width:18px; height:18px; border-radius:3px; display:inline-block}
  .bullet.A{background:linear-gradient(45deg,#8fd19f 0 50%, #8fd19f 50% 100%);}
  .bullet.B{background:
      radial-gradient(circle at 6px 6px, var(--pepperoni) 0 4px, var(--pepperoni-dark) 4px 4.5px, transparent 4.5px),
      radial-gradient(circle at 13px 12px, var(--pepperoni) 0 4px, var(--pepperoni-dark) 4px 4.5px, transparent 4.5px),
      #f8dba0;}
  .bullet.R{background:repeating-linear-gradient(45deg,var(--resto-hatch),var(--resto-hatch) 3px,#ffffff 3px,#ffffff 6px); border:1px solid #cbd5e1}
  .tag{display:inline-block; padding:4px 8px; border-radius:999px; font-weight:700; background:var(--tag); color:#111827; border:1px solid var(--grid)}
  .explain{font-size:16px; color:#374151; margin-top:4px}
  .answer{font-size:28px; font-weight:900; text-align:center; margin-top:8px}
  @page { size: A4 portrait; margin: 10mm; }
  @media print{
    body{background:#fff}
    .page{width:auto; min-height:auto; padding:0}
    .card{break-inside:avoid}
  }
</style>
</head>
<body>
<div class="page">
  <!-- Quesito pratico (dinamico) -->
  <h1 id="titoloQ">Problema: ho preso 1/2 di una pizza (basilico) e 1/3 di un’altra (pepperoni). Quanta pizza ho mangiato in totale?</h1>

  <!-- Controlli -->
  <div class="card">
    <h2>Imposta i dati del problema</h2>
    <div class="controls">
      <div>
        <label for="numA">Pizza A (basilico) – spicchi presi</label>
        <input id="numA" type="number" min="0" value="1" oninput="ricalcola()" />
      </div>
      <div>
        <label for="denA">Pizza A (basilico) – spicchi totali</label>
        <input id="denA" type="number" min="1" value="2" oninput="ricalcola()" />
      </div>
      <div>
        <label for="numB">Pizza B (pepperoni) – spicchi presi</label>
        <input id="numB" type="number" min="0" value="1" oninput="ricalcola()" />
      </div>
      <div>
        <label for="denB">Pizza B (pepperoni) – spicchi totali</label>
        <input id="denB" type="number" min="1" value="3" oninput="ricalcola()" />
      </div>
    </div>

    <!-- Frazioni singole + classificazione -->
    <div class="grid2" style="margin-top:10px">
      <div class="fracBig">A: <span id="fracA">1/2</span><br>
        <span id="tagA" class="tag">propria</span>
        <div id="expA" class="explain">Meno di una pizza intera.</div>
      </div>
      <div class="fracBig">B: <span id="fracB">1/3</span><br>
        <span id="tagB" class="tag">propria</span>
        <div id="expB" class="explain">Meno di una pizza intera.</div>
      </div>
    </div>
  </div>

  <!-- Pizze originali: A = basilico, B = pepperoni -->
  <div class="card">
    <h2>Le pizze originali</h2>
    <div class="grid2">
      <div class="pizzaBox">
        <div id="pizzaA"></div>
        <div class="mono" id="labelA">A (basilico): 1/2</div>
      </div>
      <div class="pizzaBox">
        <div id="pizzaB"></div>
        <div class="mono" id="labelB">B (pepperoni): 1/3</div>
      </div>
    </div>
    <div class="legend">
      <span class="chip"><span class="bullet A"></span> spicchi presi di A (basilico)</span>
      <span class="chip"><span class="bullet B"></span> spicchi presi di B (pepperoni)</span>
    </div>
  </div>

  <!-- MCM e somma: resto tratteggiato -->
  <div class="card">
    <h2>Denominatore comune (MCM) e somma</h2>
    <p class="eq mono" id="mcmText">MCM(2, 3) = 6</p>
    <p class="eq mono" id="sommaEq">1/2 + 1/3 = 3/6 + 2/6 = <strong>5/6</strong></p>
    <div class="center">
      <div class="pizzaBox">
        <div id="pizzaMCM"></div>
        <div class="legend">
          <span class="chip"><span class="bullet A"></span> parti di A (basilico)</span>
          <span class="chip"><span class="bullet B"></span> parti di B (pepperoni)</span>
          <span class="chip"><span class="bullet R"></span> resto (non mangiato)</span>
        </div>
        <div class="msg" id="msgInfo">L’MCM rende gli spicchi omogenei: la somma è una parte della stessa pizza.</div>
        <div class="answer" id="rispostaOperativa">Risposta: ho mangiato <strong>5/6 di pizza</strong>.</div>
        <div class="fracBig" id="tipoSommaBox">
          Tipo della somma: <span id="tagSomma" class="tag">propria</span>
          <div id="expSomma" class="explain">Meno di una pizza intera.</div>
          <div id="mistoSomma" class="explain" style="display:none">Numero misto: <span class="mono" id="mistoTxt">—</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* =======================
   Matematica essenziale
======================= */
function MCD(a,b){ a=Math.abs(a); b=Math.abs(b); while(b){const t=b; b=a%b; a=t;} return a||1; }
function MCM(a,b){ return Math.abs(a*b)/MCD(a,b); }
function semplifica(n,d){ const g=MCD(n,d); return [n/g, d/g]; }
function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function deg2rad(deg){ return deg*Math.PI/180; }

/* =======================
   Classificazione frazioni
======================= */
function classifica(n, d){
  if(n === 0) return {tipo:"zero", spieg:"Nessuna parte della pizza."};
  if(n % d === 0) return {tipo:"apparente", spieg:"Equivale a una o più pizze intere."};
  if(n < d) return {tipo:"propria", spieg:"Meno di una pizza intera."};
  return {tipo:"impropria", spieg:"Più di una pizza intera."};
}

/* =======================
   Pattern SVG (formaggio, basilico, pepperoni, tratteggio)
======================= */
function patternDefs(svg, prefix){
  const NS="http://www.w3.org/2000/svg";
  const defs=document.createElementNS(NS,"defs");

  // Formaggio puntinato
  const cheese = document.createElementNS(NS,"pattern");
  cheese.setAttribute("id", `${prefix}-cheese`);
  cheese.setAttribute("patternUnits","userSpaceOnUse");
  cheese.setAttribute("width","14"); cheese.setAttribute("height","14");
  const r1=document.createElementNS(NS,"rect");
  r1.setAttribute("width","14"); r1.setAttribute("height","14");
  r1.setAttribute("fill","var(--cheese)");
  cheese.appendChild(r1);
  for(let i=0;i<6;i++){
    const c=document.createElementNS(NS,"circle");
    c.setAttribute("cx", (i*3)%14 + 3); c.setAttribute("cy", (i*5)%14 + 3);
    c.setAttribute("r","1.2"); c.setAttribute("fill","var(--cheese-dot)");
    cheese.appendChild(c);
  }

  // Basilico
  const basil = document.createElementNS(NS,"pattern");
  basil.setAttribute("id", `${prefix}-basil`);
  basil.setAttribute("patternUnits","userSpaceOnUse");
  basil.setAttribute("width","10"); basil.setAttribute("height","10");
  const rb=document.createElementNS(NS,"rect");
  rb.setAttribute("width","10"); rb.setAttribute("height","10");
  rb.setAttribute("fill","var(--cheese)");
  basil.appendChild(rb);
  const line=document.createElementNS(NS,"path");
  line.setAttribute("d","M0,10 L10,0 M-2,8 L2,12 M8,-2 L12,2");
  line.setAttribute("stroke","var(--basil)"); line.setAttribute("stroke-width","2"); line.setAttribute("stroke-opacity","0.9");
  basil.appendChild(line);

  // Pepperoni
  const pep = document.createElementNS(NS,"pattern");
  pep.setAttribute("id", `${prefix}-pep`);
  pep.setAttribute("patternUnits","userSpaceOnUse");
  pep.setAttribute("width","22"); pep.setAttribute("height","22");
  const rp=document.createElementNS(NS,"rect");
  rp.setAttribute("width","22"); rp.setAttribute("height","22"); rp.setAttribute("fill","var(--cheese)");
  pep.appendChild(rp);
  for(let i=0;i<3;i++){
    const cx=6 + i*7, cy=6 + (i%2)*7, R=4;
    const outer=document.createElementNS(NS,"circle");
    outer.setAttribute("cx",cx); outer.setAttribute("cy",cy); outer.setAttribute("r",R);
    outer.setAttribute("fill","var(--pepperoni)"); outer.setAttribute("stroke","var(--pepperoni-dark)"); outer.setAttribute("stroke-width","1");
    pep.appendChild(outer);
    const dot=document.createElementNS(NS,"circle");
    dot.setAttribute("cx",cx-1.2); dot.setAttribute("cy",cy+1); dot.setAttribute("r","0.9"); dot.setAttribute("fill","var(--pepperoni-dark)");
    pep.appendChild(dot);
  }

  // Tratteggio per RESTO (solo nella pizza MCM)
  const hatch = document.createElementNS(NS,"pattern");
  hatch.setAttribute("id", `${prefix}-hatch`);
  hatch.setAttribute("patternUnits","userSpaceOnUse");
  hatch.setAttribute("width","8"); hatch.setAttribute("height","8");
  const bg=document.createElementNS(NS,"rect");
  bg.setAttribute("width","8"); bg.setAttribute("height","8"); bg.setAttribute("fill","#ffffff");
  hatch.appendChild(bg);
  const hline=document.createElementNS(NS,"path");
  hline.setAttribute("d","M-2,6 L6,-2 M0,8 L8,0 M2,10 L10,2");
  hline.setAttribute("stroke","var(--resto-hatch)"); hline.setAttribute("stroke-width","2");
  hatch.appendChild(hline);

  defs.appendChild(cheese); defs.appendChild(basil); defs.appendChild(pep); defs.appendChild(hatch);
  svg.appendChild(defs);
}

/* =======================
   Disegno di una pizza
   topping: "basil" (A) oppure "pep" (B)
======================= */
function drawPizza(containerId, den, num, topping){
  const r = 135, cx = 160, cy = 160;
  num = clamp(num, 0, den);
  const NS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(NS,"svg");
  svg.setAttribute("viewBox","0 0 320 320");
  svg.setAttribute("role","img");
  svg.setAttribute("aria-label", `Pizza con ${den} spicchi (${topping}), ${num} spicchi presi`);

  patternDefs(svg, containerId); // id univoci basati sul container

  // Crosta
  const crust = document.createElementNS(NS,"circle");
  crust.setAttribute("cx",cx); crust.setAttribute("cy",cy); crust.setAttribute("r", r+10);
  crust.setAttribute("fill","var(--crust)"); crust.setAttribute("stroke","var(--crust-dark)"); crust.setAttribute("stroke-width","6");
  svg.appendChild(crust);

  // Salsa
  const sauce = document.createElementNS(NS,"circle");
  sauce.setAttribute("cx",cx); sauce.setAttribute("cy",cy); sauce.setAttribute("r", r);
  sauce.setAttribute("fill","var(--sauce)");
  svg.appendChild(sauce);

  // Spicchi
  const step = 360/den;
  for(let i=0;i<den;i++){
    const start = -90 + i*step, end = start + step, large = step>180 ? 1 : 0;
    const x1 = cx + r*Math.cos(deg2rad(start)), y1 = cy + r*Math.sin(deg2rad(start));
    const x2 = cx + r*Math.cos(deg2rad(end)),   y2 = cy + r*Math.sin(deg2rad(end));
    const path = document.createElementNS(NS,"path");
    path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2} Z`);
    path.setAttribute("stroke", "#ffffff"); path.setAttribute("stroke-width", "1.2");

    // spicchi presi = topping; spicchi non presi = formaggio
    const fill = (i < num) ? `url(#${containerId}-${topping})` : `url(#${containerId}-cheese)`;
    path.setAttribute("fill", fill);
    svg.appendChild(path);
  }

  const box = document.getElementById(containerId);
  box.innerHTML = "";
  box.appendChild(svg);
}

/* =======================
   Pizza MCM: A=basil, B=pep, resto=tratteggio
======================= */
function drawPizzaMCM(containerId, den, numAeq, numBeq){
  const r = 135, cx = 160, cy = 160;
  const NS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(NS,"svg");
  svg.setAttribute("viewBox","0 0 320 320");
  svg.setAttribute("role","img");
  svg.setAttribute("aria-label", `Pizza MCM ${den} spicchi: ${numAeq} A (basilico) + ${numBeq} B (pepperoni) + resto`);

  patternDefs(svg, containerId); // creerà containerId-basil/pep/hatch

  // Crosta e salsa
  const crust = document.createElementNS(NS,"circle");
  crust.setAttribute("cx",cx); crust.setAttribute("cy",cy); crust.setAttribute("r", r+10);
  crust.setAttribute("fill","var(--crust)"); crust.setAttribute("stroke","var(--crust-dark)"); crust.setAttribute("stroke-width","6");
  svg.appendChild(crust);
  const sauce = document.createElementNS(NS,"circle");
  sauce.setAttribute("cx",cx); sauce.setAttribute("cy",cy); sauce.setAttribute("r", r);
  sauce.setAttribute("fill","var(--sauce)");
  svg.appendChild(sauce);

  const step = 360/den;
  for(let i=0;i<den;i++){
    const start = -90 + i*step, end = start + step, large = step>180 ? 1 : 0;
    const x1 = cx + r*Math.cos(deg2rad(start)), y1 = cy + r*Math.sin(deg2rad(start));
    const x2 = cx + r*Math.cos(deg2rad(end)),   y2 = cy + r*Math.sin(deg2rad(end));
    const path = document.createElementNS(NS,"path");
    path.setAttribute("d", `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2} Z`);
    path.setAttribute("stroke", "#ffffff"); path.setAttribute("stroke-width", "1.2");

    let fill = `url(#${containerId}-hatch)`; // resto
    if(i < numAeq) fill = `url(#${containerId}-basil)`;
    else if(i < numAeq + numBeq) fill = `url(#${containerId}-pep)`;
    path.setAttribute("fill", fill);
    svg.appendChild(path);
  }

  const box = document.getElementById(containerId);
  box.innerHTML = "";
  box.appendChild(svg);
}

/* =======================
   DOM e stato
======================= */
const numAEl = document.getElementById('numA');
const denAEl = document.getElementById('denA');
const numBEl = document.getElementById('numB');
const denBEl = document.getElementById('denB');
const titoloQ = document.getElementById('titoloQ');

const fracAEl = document.getElementById('fracA');
const fracBEl = document.getElementById('fracB');
const tagA = document.getElementById('tagA');
const tagB = document.getElementById('tagB');
const expA = document.getElementById('expA');
const expB = document.getElementById('expB');

const labelA = document.getElementById('labelA');
const labelB = document.getElementById('labelB');

const mcmText = document.getElementById('mcmText');
const sommaEq = document.getElementById('sommaEq');
const msgInfo = document.getElementById('msgInfo');
const rispostaOperativa = document.getElementById('rispostaOperativa');

const tagSomma = document.getElementById('tagSomma');
const expSomma = document.getElementById('expSomma');
const mistoBox = document.getElementById('mistoSomma');
const mistoTxt = document.getElementById('mistoTxt');

/* =======================
   Ricalcolo e rendering
======================= */
function ricalcola(){
  let numA = Math.max(0, Math.floor(+numAEl.value || 0));
  let denA = Math.max(1, Math.floor(+denAEl.value || 1));
  let numB = Math.max(0, Math.floor(+numBEl.value || 0));
  let denB = Math.max(1, Math.floor(+denBEl.value || 1));

  // Vincolo didattico: singolo addendo ≤ 1 pizza
  numA = clamp(numA, 0, denA); numB = clamp(numB, 0, denB);
  numAEl.value = numA; numBEl.value = numB;

  titoloQ.textContent = `Problema: ho preso ${numA}/${denA} di una pizza (basilico) e ${numB}/${denB} di un’altra (pepperoni). Quanta pizza ho mangiato in totale?`;

  const [nAs, dAs] = semplifica(numA, denA);
  const [nBs, dBs] = semplifica(numB, denB);
  fracAEl.textContent = `${numA}/${denA}` + (nAs!==numA ? ` = ${nAs}/${dAs}` : "");
  fracBEl.textContent = `${numB}/${denB}` + (nBs!==numB ? ` = ${nBs}/${dBs}` : "");

  // Classificazione singole
  const cA = classifica(numA, denA);
  const cB = classifica(numB, denB);
  tagA.textContent = cA.tipo; expA.textContent = cA.spieg;
  tagB.textContent = cB.tipo; expB.textContent = cB.spieg;

  // Pizze originali con topping coerente
  drawPizza("pizzaA", denA, numA, "basil");      // A = basilico
  drawPizza("pizzaB", denB, numB, "pep");        // B = pepperoni
  labelA.textContent = `A (basilico): ${numA}/${denA}`;
  labelB.textContent = `B (pepperoni): ${numB}/${denB}`;

  // MCM e somma
  const mcmDen = MCM(denA, denB);
  mcmText.textContent = `MCM(${denA}, ${denB}) = ${mcmDen}`;
  const numAeq = numA * (mcmDen/denA);
  const numBeq = numB * (mcmDen/denB);
  const numSum = numAeq + numBeq;
  const [nSumS, dSumS] = semplifica(numSum, mcmDen);
  sommaEq.innerHTML = `${numA}/${denA} + ${numB}/${denB} = ${numAeq}/${mcmDen} + ${numBeq}/${mcmDen} = <strong>${nSumS}/${dSumS}</strong>`;

  // Pizza MCM: A=basilico, B=pepperoni, resto tratteggiato
  drawPizzaMCM("pizzaMCM", mcmDen, numAeq, numBeq);

  // Risposta + classificazione somma + numero misto
  const clas = classifica(nSumS, dSumS);
  tagSomma.textContent = clas.tipo; expSomma.textContent = clas.spieg;
  const q = Math.floor(nSumS / dSumS), r = nSumS % dSumS;

  if(nSumS === 0){
    mistoBox.style.display = "none";
    rispostaOperativa.innerHTML = `Risposta: <strong>0</strong> (nessuna pizza).`;
    msgInfo.className = "msg warn"; msgInfo.textContent = "Somma nulla.";
  }else if(r === 0){
    mistoBox.style.display = "block"; mistoTxt.textContent = `${q}`;
    rispostaOperativa.innerHTML = `Risposta: ho mangiato <strong>${q} pizza${q>1?'e':''}</strong>.`;
    msgInfo.className = "msg ok"; msgInfo.textContent = q === 1 ? "Somma = 1: una pizza intera." : "Somma intera: più pizze complete.";
  }else if(nSumS > dSumS){
    mistoBox.style.display = "block"; mistoTxt.textContent = `${q} + ${r}/${dSumS}`;
    rispostaOperativa.innerHTML = `Risposta: ho mangiato <strong>${q} + ${r}/${dSumS} di pizza</strong>.`;
    msgInfo.className = "msg"; msgInfo.textContent = "La somma supera una pizza: numero misto (parte intera + frazione).";
  }else{
    mistoBox.style.display = "none";
    rispostaOperativa.innerHTML = `Risposta: ho mangiato <strong>${nSumS}/${dSumS} di pizza</strong>.`;
    msgInfo.className = "msg"; msgInfo.textContent = "L’MCM rende gli spicchi omogenei: la somma è una parte della stessa pizza.";
  }
}

/* Avvio */
ricalcola();
</script>
</body>
</html>
